<html><head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"/><title>Security</title><style>
/* cspell:disable-file */
/* webkit printing magic: print all background colors */
html {
	-webkit-print-color-adjust: exact;
}
* {
	box-sizing: border-box;
	-webkit-print-color-adjust: exact;
}

html,
body {
	margin: 0;
	padding: 0;
}
@media only screen {
	body {
		margin: 2em auto;
		max-width: 900px;
		color: rgb(55, 53, 47);
	}
}

body {
	line-height: 1.5;
	white-space: pre-wrap;
}

a,
a.visited {
	color: inherit;
	text-decoration: underline;
}

.pdf-relative-link-path {
	font-size: 80%;
	color: #444;
}

h1,
h2,
h3 {
	letter-spacing: -0.01em;
	line-height: 1.2;
	font-weight: 600;
	margin-bottom: 0;
}

.page-title {
	font-size: 2.5rem;
	font-weight: 700;
	margin-top: 0;
	margin-bottom: 0.75em;
}

h1 {
	font-size: 1.875rem;
	margin-top: 1.875rem;
}

h2 {
	font-size: 1.5rem;
	margin-top: 1.5rem;
}

h3 {
	font-size: 1.25rem;
	margin-top: 1.25rem;
}

.source {
	border: 1px solid #ddd;
	border-radius: 3px;
	padding: 1.5em;
	word-break: break-all;
}

.callout {
	border-radius: 3px;
	padding: 1rem;
}

figure {
	margin: 1.25em 0;
	page-break-inside: avoid;
}

figcaption {
	opacity: 0.5;
	font-size: 85%;
	margin-top: 0.5em;
}

mark {
	background-color: transparent;
}

.indented {
	padding-left: 1.5em;
}

hr {
	background: transparent;
	display: block;
	width: 100%;
	height: 1px;
	visibility: visible;
	border: none;
	border-bottom: 1px solid rgba(55, 53, 47, 0.09);
}

img {
	max-width: 100%;
}

@media only print {
	img {
		max-height: 100vh;
		object-fit: contain;
	}
}

@page {
	margin: 1in;
}

.collection-content {
	font-size: 0.875rem;
}

.column-list {
	display: flex;
	justify-content: space-between;
}

.column {
	padding: 0 1em;
}

.column:first-child {
	padding-left: 0;
}

.column:last-child {
	padding-right: 0;
}

.table_of_contents-item {
	display: block;
	font-size: 0.875rem;
	line-height: 1.3;
	padding: 0.125rem;
}

.table_of_contents-indent-1 {
	margin-left: 1.5rem;
}

.table_of_contents-indent-2 {
	margin-left: 3rem;
}

.table_of_contents-indent-3 {
	margin-left: 4.5rem;
}

.table_of_contents-link {
	text-decoration: none;
	opacity: 0.7;
	border-bottom: 1px solid rgba(55, 53, 47, 0.18);
}

table,
th,
td {
	border: 1px solid rgba(55, 53, 47, 0.09);
	border-collapse: collapse;
}

table {
	border-left: none;
	border-right: none;
}

th,
td {
	font-weight: normal;
	padding: 0.25em 0.5em;
	line-height: 1.5;
	min-height: 1.5em;
	text-align: left;
}

th {
	color: rgba(55, 53, 47, 0.6);
}

ol,
ul {
	margin: 0;
	margin-block-start: 0.6em;
	margin-block-end: 0.6em;
}

li > ol:first-child,
li > ul:first-child {
	margin-block-start: 0.6em;
}

ul > li {
	list-style: disc;
}

ul.to-do-list {
	text-indent: -1.7em;
}

ul.to-do-list > li {
	list-style: none;
}

.to-do-children-checked {
	text-decoration: line-through;
	opacity: 0.375;
}

ul.toggle > li {
	list-style: none;
}

ul {
	padding-inline-start: 1.7em;
}

ul > li {
	padding-left: 0.1em;
}

ol {
	padding-inline-start: 1.6em;
}

ol > li {
	padding-left: 0.2em;
}

.mono ol {
	padding-inline-start: 2em;
}

.mono ol > li {
	text-indent: -0.4em;
}

.toggle {
	padding-inline-start: 0em;
	list-style-type: none;
}

/* Indent toggle children */
.toggle > li > details {
	padding-left: 1.7em;
}

.toggle > li > details > summary {
	margin-left: -1.1em;
}

.selected-value {
	display: inline-block;
	padding: 0 0.5em;
	background: rgba(206, 205, 202, 0.5);
	border-radius: 3px;
	margin-right: 0.5em;
	margin-top: 0.3em;
	margin-bottom: 0.3em;
	white-space: nowrap;
}

.collection-title {
	display: inline-block;
	margin-right: 1em;
}

.simple-table {
	margin-top: 1em;
	font-size: 0.875rem;
	empty-cells: show;
}
.simple-table td {
	height: 29px;
	min-width: 120px;
}

.simple-table th {
	height: 29px;
	min-width: 120px;
}

.simple-table-header-color {
	background: rgb(247, 246, 243);
	color: black;
}
.simple-table-header {
	font-weight: 500;
}

time {
	opacity: 0.5;
}

.icon {
	display: inline-block;
	max-width: 1.2em;
	max-height: 1.2em;
	text-decoration: none;
	vertical-align: text-bottom;
	margin-right: 0.5em;
}

img.icon {
	border-radius: 3px;
}

.user-icon {
	width: 1.5em;
	height: 1.5em;
	border-radius: 100%;
	margin-right: 0.5rem;
}

.user-icon-inner {
	font-size: 0.8em;
}

.text-icon {
	border: 1px solid #000;
	text-align: center;
}

.page-cover-image {
	display: block;
	object-fit: cover;
	width: 100%;
	max-height: 30vh;
}

.page-header-icon {
	font-size: 3rem;
	margin-bottom: 1rem;
}

.page-header-icon-with-cover {
	margin-top: -0.72em;
	margin-left: 0.07em;
}

.page-header-icon img {
	border-radius: 3px;
}

.link-to-page {
	margin: 1em 0;
	padding: 0;
	border: none;
	font-weight: 500;
}

p > .user {
	opacity: 0.5;
}

td > .user,
td > time {
	white-space: nowrap;
}

input[type="checkbox"] {
	transform: scale(1.5);
	margin-right: 0.6em;
	vertical-align: middle;
}

p {
	margin-top: 0.5em;
	margin-bottom: 0.5em;
}

.image {
	border: none;
	margin: 1.5em 0;
	padding: 0;
	border-radius: 0;
	text-align: center;
}

.code,
code {
	background: rgba(135, 131, 120, 0.15);
	border-radius: 3px;
	padding: 0.2em 0.4em;
	border-radius: 3px;
	font-size: 85%;
	tab-size: 2;
}

code {
	color: #eb5757;
}

.code {
	padding: 1.5em 1em;
}

.code-wrap {
	white-space: pre-wrap;
	word-break: break-all;
}

.code > code {
	background: none;
	padding: 0;
	font-size: 100%;
	color: inherit;
}

blockquote {
	font-size: 1.25em;
	margin: 1em 0;
	padding-left: 1em;
	border-left: 3px solid rgb(55, 53, 47);
}

.bookmark {
	text-decoration: none;
	max-height: 8em;
	padding: 0;
	display: flex;
	width: 100%;
	align-items: stretch;
}

.bookmark-title {
	font-size: 0.85em;
	overflow: hidden;
	text-overflow: ellipsis;
	height: 1.75em;
	white-space: nowrap;
}

.bookmark-text {
	display: flex;
	flex-direction: column;
}

.bookmark-info {
	flex: 4 1 180px;
	padding: 12px 14px 14px;
	display: flex;
	flex-direction: column;
	justify-content: space-between;
}

.bookmark-image {
	width: 33%;
	flex: 1 1 180px;
	display: block;
	position: relative;
	object-fit: cover;
	border-radius: 1px;
}

.bookmark-description {
	color: rgba(55, 53, 47, 0.6);
	font-size: 0.75em;
	overflow: hidden;
	max-height: 4.5em;
	word-break: break-word;
}

.bookmark-href {
	font-size: 0.75em;
	margin-top: 0.25em;
}

.sans { font-family: ui-sans-serif, -apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, "Apple Color Emoji", Arial, sans-serif, "Segoe UI Emoji", "Segoe UI Symbol"; }
.code { font-family: "SFMono-Regular", Menlo, Consolas, "PT Mono", "Liberation Mono", Courier, monospace; }
.serif { font-family: Lyon-Text, Georgia, ui-serif, serif; }
.mono { font-family: iawriter-mono, Nitti, Menlo, Courier, monospace; }
.pdf .sans { font-family: Inter, ui-sans-serif, -apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, "Apple Color Emoji", Arial, sans-serif, "Segoe UI Emoji", "Segoe UI Symbol", 'Twemoji', 'Noto Color Emoji', 'Noto Sans CJK JP'; }
.pdf:lang(zh-CN) .sans { font-family: Inter, ui-sans-serif, -apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, "Apple Color Emoji", Arial, sans-serif, "Segoe UI Emoji", "Segoe UI Symbol", 'Twemoji', 'Noto Color Emoji', 'Noto Sans CJK SC'; }
.pdf:lang(zh-TW) .sans { font-family: Inter, ui-sans-serif, -apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, "Apple Color Emoji", Arial, sans-serif, "Segoe UI Emoji", "Segoe UI Symbol", 'Twemoji', 'Noto Color Emoji', 'Noto Sans CJK TC'; }
.pdf:lang(ko-KR) .sans { font-family: Inter, ui-sans-serif, -apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, "Apple Color Emoji", Arial, sans-serif, "Segoe UI Emoji", "Segoe UI Symbol", 'Twemoji', 'Noto Color Emoji', 'Noto Sans CJK KR'; }
.pdf .code { font-family: Source Code Pro, "SFMono-Regular", Menlo, Consolas, "PT Mono", "Liberation Mono", Courier, monospace, 'Twemoji', 'Noto Color Emoji', 'Noto Sans Mono CJK JP'; }
.pdf:lang(zh-CN) .code { font-family: Source Code Pro, "SFMono-Regular", Menlo, Consolas, "PT Mono", "Liberation Mono", Courier, monospace, 'Twemoji', 'Noto Color Emoji', 'Noto Sans Mono CJK SC'; }
.pdf:lang(zh-TW) .code { font-family: Source Code Pro, "SFMono-Regular", Menlo, Consolas, "PT Mono", "Liberation Mono", Courier, monospace, 'Twemoji', 'Noto Color Emoji', 'Noto Sans Mono CJK TC'; }
.pdf:lang(ko-KR) .code { font-family: Source Code Pro, "SFMono-Regular", Menlo, Consolas, "PT Mono", "Liberation Mono", Courier, monospace, 'Twemoji', 'Noto Color Emoji', 'Noto Sans Mono CJK KR'; }
.pdf .serif { font-family: PT Serif, Lyon-Text, Georgia, ui-serif, serif, 'Twemoji', 'Noto Color Emoji', 'Noto Serif CJK JP'; }
.pdf:lang(zh-CN) .serif { font-family: PT Serif, Lyon-Text, Georgia, ui-serif, serif, 'Twemoji', 'Noto Color Emoji', 'Noto Serif CJK SC'; }
.pdf:lang(zh-TW) .serif { font-family: PT Serif, Lyon-Text, Georgia, ui-serif, serif, 'Twemoji', 'Noto Color Emoji', 'Noto Serif CJK TC'; }
.pdf:lang(ko-KR) .serif { font-family: PT Serif, Lyon-Text, Georgia, ui-serif, serif, 'Twemoji', 'Noto Color Emoji', 'Noto Serif CJK KR'; }
.pdf .mono { font-family: PT Mono, iawriter-mono, Nitti, Menlo, Courier, monospace, 'Twemoji', 'Noto Color Emoji', 'Noto Sans Mono CJK JP'; }
.pdf:lang(zh-CN) .mono { font-family: PT Mono, iawriter-mono, Nitti, Menlo, Courier, monospace, 'Twemoji', 'Noto Color Emoji', 'Noto Sans Mono CJK SC'; }
.pdf:lang(zh-TW) .mono { font-family: PT Mono, iawriter-mono, Nitti, Menlo, Courier, monospace, 'Twemoji', 'Noto Color Emoji', 'Noto Sans Mono CJK TC'; }
.pdf:lang(ko-KR) .mono { font-family: PT Mono, iawriter-mono, Nitti, Menlo, Courier, monospace, 'Twemoji', 'Noto Color Emoji', 'Noto Sans Mono CJK KR'; }
.highlight-default {
	color: rgba(55, 53, 47, 1);
}
.highlight-gray {
	color: rgba(120, 119, 116, 1);
	fill: rgba(120, 119, 116, 1);
}
.highlight-brown {
	color: rgba(159, 107, 83, 1);
	fill: rgba(159, 107, 83, 1);
}
.highlight-orange {
	color: rgba(217, 115, 13, 1);
	fill: rgba(217, 115, 13, 1);
}
.highlight-yellow {
	color: rgba(203, 145, 47, 1);
	fill: rgba(203, 145, 47, 1);
}
.highlight-teal {
	color: rgba(68, 131, 97, 1);
	fill: rgba(68, 131, 97, 1);
}
.highlight-blue {
	color: rgba(51, 126, 169, 1);
	fill: rgba(51, 126, 169, 1);
}
.highlight-purple {
	color: rgba(144, 101, 176, 1);
	fill: rgba(144, 101, 176, 1);
}
.highlight-pink {
	color: rgba(193, 76, 138, 1);
	fill: rgba(193, 76, 138, 1);
}
.highlight-red {
	color: rgba(212, 76, 71, 1);
	fill: rgba(212, 76, 71, 1);
}
.highlight-gray_background {
	background: rgba(241, 241, 239, 1);
}
.highlight-brown_background {
	background: rgba(244, 238, 238, 1);
}
.highlight-orange_background {
	background: rgba(251, 236, 221, 1);
}
.highlight-yellow_background {
	background: rgba(251, 243, 219, 1);
}
.highlight-teal_background {
	background: rgba(237, 243, 236, 1);
}
.highlight-blue_background {
	background: rgba(231, 243, 248, 1);
}
.highlight-purple_background {
	background: rgba(244, 240, 247, 0.8);
}
.highlight-pink_background {
	background: rgba(249, 238, 243, 0.8);
}
.highlight-red_background {
	background: rgba(253, 235, 236, 1);
}
.block-color-default {
	color: inherit;
	fill: inherit;
}
.block-color-gray {
	color: rgba(120, 119, 116, 1);
	fill: rgba(120, 119, 116, 1);
}
.block-color-brown {
	color: rgba(159, 107, 83, 1);
	fill: rgba(159, 107, 83, 1);
}
.block-color-orange {
	color: rgba(217, 115, 13, 1);
	fill: rgba(217, 115, 13, 1);
}
.block-color-yellow {
	color: rgba(203, 145, 47, 1);
	fill: rgba(203, 145, 47, 1);
}
.block-color-teal {
	color: rgba(68, 131, 97, 1);
	fill: rgba(68, 131, 97, 1);
}
.block-color-blue {
	color: rgba(51, 126, 169, 1);
	fill: rgba(51, 126, 169, 1);
}
.block-color-purple {
	color: rgba(144, 101, 176, 1);
	fill: rgba(144, 101, 176, 1);
}
.block-color-pink {
	color: rgba(193, 76, 138, 1);
	fill: rgba(193, 76, 138, 1);
}
.block-color-red {
	color: rgba(212, 76, 71, 1);
	fill: rgba(212, 76, 71, 1);
}
.block-color-gray_background {
	background: rgba(241, 241, 239, 1);
}
.block-color-brown_background {
	background: rgba(244, 238, 238, 1);
}
.block-color-orange_background {
	background: rgba(251, 236, 221, 1);
}
.block-color-yellow_background {
	background: rgba(251, 243, 219, 1);
}
.block-color-teal_background {
	background: rgba(237, 243, 236, 1);
}
.block-color-blue_background {
	background: rgba(231, 243, 248, 1);
}
.block-color-purple_background {
	background: rgba(244, 240, 247, 0.8);
}
.block-color-pink_background {
	background: rgba(249, 238, 243, 0.8);
}
.block-color-red_background {
	background: rgba(253, 235, 236, 1);
}
.select-value-color-pink { background-color: rgba(245, 224, 233, 1); }
.select-value-color-purple { background-color: rgba(232, 222, 238, 1); }
.select-value-color-green { background-color: rgba(219, 237, 219, 1); }
.select-value-color-gray { background-color: rgba(227, 226, 224, 1); }
.select-value-color-opaquegray { background-color: rgba(255, 255, 255, 0.0375); }
.select-value-color-orange { background-color: rgba(250, 222, 201, 1); }
.select-value-color-brown { background-color: rgba(238, 224, 218, 1); }
.select-value-color-red { background-color: rgba(255, 226, 221, 1); }
.select-value-color-yellow { background-color: rgba(253, 236, 200, 1); }
.select-value-color-blue { background-color: rgba(211, 229, 239, 1); }

.checkbox {
	display: inline-flex;
	vertical-align: text-bottom;
	width: 16;
	height: 16;
	background-size: 16px;
	margin-left: 2px;
	margin-right: 5px;
}

.checkbox-on {
	background-image: url("data:image/svg+xml;charset=UTF-8,%3Csvg%20width%3D%2216%22%20height%3D%2216%22%20viewBox%3D%220%200%2016%2016%22%20fill%3D%22none%22%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%3E%0A%3Crect%20width%3D%2216%22%20height%3D%2216%22%20fill%3D%22%2358A9D7%22%2F%3E%0A%3Cpath%20d%3D%22M6.71429%2012.2852L14%204.9995L12.7143%203.71436L6.71429%209.71378L3.28571%206.2831L2%207.57092L6.71429%2012.2852Z%22%20fill%3D%22white%22%2F%3E%0A%3C%2Fsvg%3E");
}

.checkbox-off {
	background-image: url("data:image/svg+xml;charset=UTF-8,%3Csvg%20width%3D%2216%22%20height%3D%2216%22%20viewBox%3D%220%200%2016%2016%22%20fill%3D%22none%22%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%3E%0A%3Crect%20x%3D%220.75%22%20y%3D%220.75%22%20width%3D%2214.5%22%20height%3D%2214.5%22%20fill%3D%22white%22%20stroke%3D%22%2336352F%22%20stroke-width%3D%221.5%22%2F%3E%0A%3C%2Fsvg%3E");
}
	
</style></head><body><article id="52520df4-1a28-441e-bdd8-4e850d3d2b10" class="page sans"><header><img class="page-cover-image" src="https://www.notion.so/images/page-cover/nasa_fingerprints_of_water_on_the_sand.jpg" style="object-position:center 60%"/><div class="page-header-icon page-header-icon-with-cover"><span class="icon">🛰️</span></div><h1 class="page-title">Security</h1></header><div class="page-body"><p id="b38d5d48-9075-4f38-a82c-f59566839956" class="">
</p><nav id="dc11ca3f-6f8e-46d4-b896-f81511bb849d" class="block-color-gray table_of_contents"><div class="table_of_contents-item table_of_contents-indent-0"><a class="table_of_contents-link" href="#8dc7d891-ab36-4ee1-9e52-8d6059fcc823">Password Hashing</a></div><div class="table_of_contents-item table_of_contents-indent-1"><a class="table_of_contents-link" href="#84de3a15-87d2-4ab9-adb9-d8e3491abfc5">bcrypt</a></div><div class="table_of_contents-item table_of_contents-indent-2"><a class="table_of_contents-link" href="#2fb81451-5365-4d4a-b76e-955cbdc28248">Storing passwords</a></div><div class="table_of_contents-item table_of_contents-indent-2"><a class="table_of_contents-link" href="#a5c5891a-71f7-4efb-8211-c95a2d814f77">Checking passwords</a></div><div class="table_of_contents-item table_of_contents-indent-0"><a class="table_of_contents-link" href="#b5fbedca-fa70-4ecd-ab05-9e3cd90a50fb">Sessions</a></div><div class="table_of_contents-item table_of_contents-indent-1"><a class="table_of_contents-link" href="#07de26b1-00b5-4c53-a4ce-2d293fec62ca">cookie session middleware</a></div><div class="table_of_contents-item table_of_contents-indent-0"><a class="table_of_contents-link" href="#2b481cae-a22e-4488-b8ba-50698f3841c2">Security and Real World HTTP Servers</a></div><div class="table_of_contents-item table_of_contents-indent-1"><a class="table_of_contents-link" href="#56693a3a-5993-49e2-880c-0d678bb7a86b">Outline</a></div><div class="table_of_contents-item table_of_contents-indent-0"><a class="table_of_contents-link" href="#72458ce7-0753-40d7-a91a-c0018b862ced">Security</a></div><div class="table_of_contents-item table_of_contents-indent-1"><a class="table_of_contents-link" href="#fedb54b1-40d3-40ef-9a75-233aba1b86aa">Storing passwords</a></div><div class="table_of_contents-item table_of_contents-indent-1"><a class="table_of_contents-link" href="#034cb40d-760f-4ec1-aed3-4218d8cec98d">Encrypting cookies</a></div><div class="table_of_contents-item table_of_contents-indent-2"><a class="table_of_contents-link" href="#8b05e4e6-f0cd-4ac2-b40b-8e8c21526f01">When can I use plain text cookies?</a></div><div class="table_of_contents-item table_of_contents-indent-1"><a class="table_of_contents-link" href="#9e8cdcbf-e39e-4cb0-8593-ca626968d488">HTTPS</a></div><div class="table_of_contents-item table_of_contents-indent-2"><a class="table_of_contents-link" href="#fa02deab-50a3-4f53-9a2b-d475caac98ab">Man-in-the-middle attacks</a></div><div class="table_of_contents-item table_of_contents-indent-0"><a class="table_of_contents-link" href="#8e591447-ceb7-4087-829c-d325f42e04a1">Cross-Site Scripting {XSS}</a></div><div class="table_of_contents-item table_of_contents-indent-1"><a class="table_of_contents-link" href="#d584ae6a-6255-489a-88da-bce94f1dba01">Method 1</a></div><div class="table_of_contents-item table_of_contents-indent-1"><a class="table_of_contents-link" href="#4287c9cd-cca8-4374-875f-2f197570b283">Method 2</a></div></nav><p id="b9671a5d-ff13-41ad-afb2-21149ebf1d59" class="">
</p><p id="0587a88a-1b57-4b50-8758-3bb41e70cd85" class="">
</p><p id="dab2fe27-e83b-4801-a627-801c4188732c" class="">
</p><h1 id="8dc7d891-ab36-4ee1-9e52-8d6059fcc823" class="">Password Hashing</h1><p id="2000db8b-a48e-4f51-92b5-c80060134aeb" class="">
</p><p id="f48a5515-3ae8-4aed-b136-cae4588afefe" class="">encryotion can be reversed with a key</p><p id="528d5ed6-952a-40f0-8ec7-d28b995bd192" class="">hashing is one way and cannot be reversed.. <div class="indented"><p id="52a2fbdb-1427-4233-a607-f1fc1002c705" class="">so this is how you store your passwords→ with the hash. </p></div></p><p id="e6e6bc06-d8db-44d0-817f-71689d1a50e7" class="">Compare the hashes.</p><p id="0733c4c1-7054-4413-aaf1-f3b67001c8cb" class="">
</p><h2 id="84de3a15-87d2-4ab9-adb9-d8e3491abfc5" class="">bcrypt</h2><pre id="7baf3a48-02cd-4e0a-a3e6-cfee1a5ee85a" class="code"><code>npm install -E bcrypt@2.0.0</code></pre><h3 id="2fb81451-5365-4d4a-b76e-955cbdc28248" class="">Storing passwords</h3><pre id="723905bb-36ed-4400-bddd-0e32a9efd626" class="code"><code>const bcrypt = require(&#x27;bcrypt&#x27;);
const password = &quot;purple-monkey-dinosaur&quot;; // found in the req.params object
const hashedPassword = bcrypt.hashSync(password, 10);</code></pre><p id="4966f183-c8ce-4a04-ac73-29b8037dd7de" class="">
</p><h3 id="a5c5891a-71f7-4efb-8211-c95a2d814f77" class="">Checking passwords</h3><pre id="2806319a-837b-47f1-899f-51e570ac8ac8" class="code"><code>bcrypt.compareSync(&quot;purple-monkey-dinosaur&quot;, hashedPassword); // returns true
bcrypt.compareSync(&quot;pink-donkey-minotaur&quot;, hashedPassword); // returns false</code></pre><p id="e0a043b4-3886-467f-a42b-3fc993d40666" class="">
</p><figure class="block-color-gray_background callout" style="white-space:pre-wrap;display:flex" id="c1b76d86-7fb7-492e-a813-d554d5692aca"><div style="font-size:1.5em"><span class="icon">⚠️</span></div><div style="width:100%">Do <em>not</em> reuse <code>bcrypt.hashSync</code> when checking if the password&#x27;s match, ie. do <em>not</em> do the following:</div></figure><pre id="7eeb3fb9-81c4-4b53-91ab-689a55362f07" class="code"><code>if (bcrypt.hashSync(&quot;purple-monkey-dinosaur&quot;) === hashedPassword)) { ... }</code></pre><p id="266ca353-74f3-4dc8-86b5-412f67c5ce11" class="">
</p><p id="e1a39c85-6136-48c6-8061-78fd4086c4ec" class="">
</p><h1 id="b5fbedca-fa70-4ecd-ab05-9e3cd90a50fb" class="">Sessions</h1><p id="92334a51-845f-4664-b1e6-b6ee1af22178" class="">
</p><p id="5a879a5f-a02b-4cf1-bc97-5d5355089e28" class="">When the word <strong>session</strong> comes up in web development, it can mean a variety of things. Here&#x27;s a quick list of the different types of sessions we might see while developing a website with secure log in capabilities.</p><ul id="bbf630a3-26af-4c18-8b85-3adc33da2ce1" class="bulleted-list"><li style="list-style-type:disc">session cookies - cookies that expire after a browser is closed</li></ul><ul id="6e6b9d80-56a6-4e0f-b4cb-b5493b0ba4be" class="bulleted-list"><li style="list-style-type:disc">user session - login/logout features on a site</li></ul><ul id="787c9f38-1c37-4188-bea7-4444f0a9f240" class="bulleted-list"><li style="list-style-type:disc">user session - the event of a user using an application</li></ul><ul id="d62283ea-5a3c-494d-840f-b83e7f01bef5" class="bulleted-list"><li style="list-style-type:disc">session - encrypted cookies</li></ul><ul id="9af166aa-37c4-4b09-b741-95de157dd813" class="bulleted-list"><li style="list-style-type:disc">session - abstraction that refers to user data, can be tracked in various ways:<ol type="1" id="f3b1c0b3-c60c-45c1-8751-8e2d7ab56795" class="numbered-list" start="1"><li>storing data in an encrypted cookie</li></ol><ol type="1" id="6c4b6234-d501-4bb2-b83e-9e9c7cfb57aa" class="numbered-list" start="2"><li>storing an id in an encrypted cookie w/ a session store on the server-side</li></ol></li></ul><p id="13ec428c-d75b-48dc-b376-65450064e8e3" class="">
</p><h2 id="07de26b1-00b5-4c53-a4ce-2d293fec62ca" class="">cookie session middleware</h2><p id="cbe8068f-07c7-4938-81b9-a205e30e09d8" class=""><a href="https://github.com/expressjs/cookie-session">https://github.com/expressjs/cookie-session</a></p><p id="24991c42-3166-481f-a374-824fad90343e" class="">
</p><pre id="968ac1aa-828d-4525-8d7d-c83eec3158d4" class="code"><code>npm install cookie-session</code></pre><p id="98ac3325-3222-4859-9b9c-9e498242ac1a" class="">The syntax to read and set values in cookies is different.</p><p id="2f0ed1f1-d59a-42b0-ba4c-1b30e2363b09" class="">To set the <code>user_id</code> key on a session, write:</p><pre id="0e52426b-88ce-4681-9e56-2ed3e8932de5" class="code code-wrap"><code>req.session.user_id = &quot;some value&quot;;</code></pre><p id="eb47f97c-6a5d-497a-8f78-51ffefe00191" class="">To read a value, write:</p><pre id="c6e6630e-36bc-4847-a66b-30f4c559562c" class="code code-wrap"><code>req.session.user_id</code></pre><p id="79c48579-9946-4017-b18e-901374f41eac" class="">
</p><p id="d6c653cc-d23d-418b-8c2c-ccb1cdf03d36" class="">
</p><h1 id="2b481cae-a22e-4488-b8ba-50698f3841c2" class="">Security and Real World HTTP Servers</h1><h2 id="56693a3a-5993-49e2-880c-0d678bb7a86b" class="">Outline</h2><ol type="1" id="77acb4ce-6412-425e-94c2-92b7ef9043c6" class="numbered-list" start="1"><li>Security<ol type="a" id="1beacc29-9b91-47f7-bc56-f3eff94a6570" class="numbered-list" start="1"><li>Storing passwords</li></ol><ol type="a" id="5d6a8250-7d69-4847-b6b4-a45cf0bc6c32" class="numbered-list" start="2"><li>Encrypting cookies</li></ol><ol type="a" id="7856b2da-b6dd-4de6-bda5-65a876e97dd7" class="numbered-list" start="3"><li>HTTPS</li></ol></li></ol><ol type="1" id="06ffe7c3-54ee-452d-a01d-453215e9f8d3" class="numbered-list" start="2"><li>REST &amp; Advanced Express<ol type="a" id="dea5acbe-4093-4cf6-84fc-1c2a8948129c" class="numbered-list" start="1"><li>REST</li></ol><ol type="a" id="f7190bbe-f933-4136-8269-ca0ed42bf2db" class="numbered-list" start="2"><li>Express modules</li></ol></li></ol><h1 id="72458ce7-0753-40d7-a91a-c0018b862ced" class="">Security</h1><p id="55bf59c6-c88e-4f4a-bd2e-db2c018dbdb9" class="">When building web apps we often refer to a strategy called <code>zero trust</code>. Zero trust tells us that we should never trust an incoming request and helps us prevent data breaches by ensuring at every stage that the request is coming from an authorized party.</p><h2 id="fedb54b1-40d3-40ef-9a75-233aba1b86aa" class="">Storing passwords</h2><p id="b6273de7-c964-4b8f-a907-a4fecd995851" class="">When building an application it&#x27;s easy to begin storing passwords as plain text in our database. After all, if done correctly no one but you should have access to your database so what&#x27;s the harm right? In reality we can all think of a few major data breaches at well known companies with security professionals much more experienced than we are. Since we don&#x27;t trust anybody we&#x27;re going to assume that every piece of our app is vulnerable!</p><p id="6fee6aaa-32dd-49e6-903a-8992efeaf999" class="">So if we assume our database is vulnerable, we must hash our passwords in order to protect users data.</p><blockquote id="dc26b054-64df-43f0-b88a-e1bf26de2d0a" class="">Hashing is a one-way function that scrambles plain text or a key. One-way means that it cannot be unscrambled to get the original value. This means that even if someone hacks our database and steals all our users&#x27; passwords they can&#x27;t reverse engineer the hashed values to figure out the user&#x27;s original password.</blockquote><p id="c61d7324-5b3e-49e2-bdd3-3f4d5e2087ea" class=""><em><strong>Don&#x27;t roll your own encryption!</strong></em></p><ul id="05f1c364-d3bb-42ba-ac11-065f9410997e" class="bulleted-list"><li style="list-style-type:disc"> Bcrypt is a password-hashing function that has been built into an <code>npm</code> package of the same name that lets us quickly hash passwords and compare input to hashed values.</li></ul><p id="7317a7d3-76a4-4c66-97cc-a75525995879" class=""><a href="https://openbase.com/js/bcrypt/documentation">Bcrypt documentation</a></p><h2 id="034cb40d-760f-4ec1-aed3-4218d8cec98d" class="">Encrypting cookies</h2><p id="b68a3bfc-8bc2-4def-b0eb-84c39eafcb23" class="">Why do we use cookies? HTTP is stateless, which means we can&#x27;t remember anything about previous requests. We use cookies to get around this and store data for our server to read again, such as whether a user is logged in.</p><p id="14176943-b647-453d-aa1a-511554735234" class="">Cookie values are plain text by default and since they belong to a user they can be changed manually at will. So how do we trust the data in a cookie? We don&#x27;t!</p><p id="dca26169-9b71-4ed0-82af-eb2b73924a09" class="">Whenever we store data in a cookie we should encrypt that data by default. This means that if someone is able to view a user&#x27;s cookies they won&#x27;t be able to read any of the data stored there. Further if a user changes the cookie&#x27;s value the result will simply be nonsense when unencrypted.</p><p id="0b15fc95-a0ea-410b-b641-af13ec21cb7e" class="">Why do we care if cookies are visible to the user? Because we store their data their! If we store a user&#x27;s id in a cookie as plain text then anyone could pretend to be that user by changing their cookie&#x27;s value to that id.</p><blockquote id="9e65f2a1-5ff1-4d2c-b47f-b05699dddb67" class="">Encryption is a two-way function that turns plain text into what we refer to as ciphertext. Ciphertext is scrambled text that can&#x27;t be read without decrypting it. Because encryption is two-way this means that the resulting ciphertext can be unscrambled (or decrypted) by anyone with the correct key.</blockquote><p id="5666f542-ba3d-4ebf-bfe8-467bce72ee7d" class="">So how do we encrypt our cookies in express? One option is a middleware called <code>cookie-session</code>.</p><p id="60b904f1-3fe9-4a1a-983c-ec4705413767" class=""><a href="https://github.com/expressjs/cookie-session">Cookie session documentation</a></p><h3 id="8b05e4e6-f0cd-4ac2-b40b-8e8c21526f01" class="">When can I use plain text cookies?</h3><p id="9a9950eb-39d5-4ba8-b725-e30b091786a8" class="">While encrypted cookies should be your default there are some scenarios when it <strong>might</strong> be appropriate to use plain text cookies.</p><ul id="a089b5b1-3540-4b51-ab64-05845a7558b7" class="bulleted-list"><li style="list-style-type:disc">language preferences</li></ul><ul id="2bdfb860-4a7b-47fa-a8a1-f9145ae2d471" class="bulleted-list"><li style="list-style-type:disc">shopping cart for non-logged in users</li></ul><ul id="26b3b7c7-ad13-444b-b13d-9d3b60a12efa" class="bulleted-list"><li style="list-style-type:disc">analytics</li></ul><h2 id="9e8cdcbf-e39e-4cb0-8593-ca626968d488" class="">HTTPS</h2><p id="7f0397c3-84e7-4866-b637-533f0d2aed50" class="">HTTP is plain text! Using HTTP any data we send over the internet is easily read by anyone that is able to intercept our request. So even if we&#x27;ve hashed passwords in our database when a user logs in the password they type into our password field is sent in plain text to the server.</p><p id="13bbc6b7-2f70-42a5-bebe-1e6e1ad3f2d4" class="">This is where HTTPS comes in! HTTPS (the S is for secure) is end-to-end encrypted, meaning the data sent in the request cannot be read while it is in transit. This is achieved through public-key encryption.</p><blockquote id="1a2a568e-f618-44d8-8db9-167149f30166" class="">Public-key encryption is an encryption method where one key (the public key) is used to encrypt plain text and the resulting ciphertext can only be decrypted with another key (the private key). This way we can share our public key with anyone that wants to send us a message and that message cannot be read by anyone unless they have our private key (even if they have the public key). This strategy is an alternative to symmetric-key encryption where the same key is used to both encrypt plain text and decrypt ciphertext.</blockquote><p id="0cb07e56-6ac4-47da-bbb1-a595bb29099a" class=""><a href="https://letsencrypt.org/about/">Let&#x27;s Encrypt</a> is a non-profit authority run by the <a href="https://www.abetterinternet.org/">Internet Security Research Group (ISRG)</a> that provides free certificates needed to enable HTTPS for websites.</p><h3 id="fa02deab-50a3-4f53-9a2b-d475caac98ab" class="">Man-in-the-middle attacks</h3><p id="841926e6-0531-47d0-a6ff-e1f2ff1f0913" class="">One of the most common ways that people try hack users and websites is through a <em>man-in-the-middle</em> attack. This is where a hacker intercepts traffic between to parties (eg. a user&#x27;s browser and our server) and can either read the data being sent or can alter that data in some way.</p><p id="d850b99f-e09d-4112-94e7-45896fb2d4be" class="">One example of this is <a href="https://en.wikipedia.org/wiki/Firesheep">Firesheep</a> which was a firefox extension that allowed users to intercept cookies on public wifi for sites like Facebook and hijack that users logged in session.</p><p id="0f595a03-61ec-49f4-bcfd-b30ce29a434d" class="">
</p><p id="f8d18e96-de96-4c87-8dd9-064197dd41ac" class="">
</p><h1 id="8e591447-ceb7-4087-829c-d325f42e04a1" class="">Cross-Site Scripting {XSS}</h1><hr id="ae0904a6-1adc-409d-a3e7-4be34875685c"/><p id="adb7e6d6-a4d1-4dfe-a80d-c2258d5a6cb4" class="">
</p><p id="67d15f67-ecdd-4fb1-b61c-2fbf4266be20" class="">An XSS attack is a type of code injection: user input is mistakenly interpreted as malicious program code. In order to prevent this type of code injection, secure input handling is needed.</p><p id="0a76d4c6-da35-446a-9554-37b95a672f89" class="">
</p><figure id="1081ea3e-3d01-49b2-902a-c01dfb847b40"><a href="https://en.wikipedia.org/wiki/Cross-site_scripting" class="bookmark source"><div class="bookmark-info"><div class="bookmark-text"><div class="bookmark-title">Cross-site scripting - Wikipedia</div><div class="bookmark-description">Cross-site scripting ( XSS) is a type of security vulnerability that can be found in some web applications. XSS attacks enable attackers to inject client-side scripts into web pages viewed by other users. A cross-site scripting vulnerability may be used by attackers to bypass access controls such as the same-origin policy.</div></div><div class="bookmark-href"><img src="https://en.wikipedia.org/static/favicon/wikipedia.ico" class="icon bookmark-icon"/>https://en.wikipedia.org/wiki/Cross-site_scripting</div></div><img src="https://upload.wikimedia.org/wikipedia/commons/thumb/3/38/Information_Security_Incidents_by_Category%2C_Fiscal_Year_2014.svg/1200px-Information_Security_Incidents_by_Category%2C_Fiscal_Year_2014.svg.png" class="bookmark-image"/></a></figure><p id="1e62650d-eace-4ce1-bae3-f7ba7a5acfb6" class="">
</p><p id="132a3bdd-d1bd-47ab-90bb-76d118786312" class="">When including text in our templates, we have to be careful not to <em>evaluate</em> text that comes from untrusted sources (ie. users). If a template treats untrusted text as HTML, then a cunning user could craft their input text to run JavaScript on other user&#x27;s pages. For example, a user of our app could enter the following tweet:</p><pre id="1fa04450-3f12-4961-8a49-eebefeac4131" class="code"><code>&lt;script&gt;alert(&#x27;uh oh!&#x27;);&lt;/script&gt;</code></pre><p id="eaa67e1d-b36d-41e8-ba96-8ee240d6e2b7" class="">
</p><ol type="1" id="9dddf745-f7f0-4c86-bd43-70cd5ff29690" class="numbered-list" start="1"><li>Identify the entry point is</li></ol><ol type="1" id="81302f2a-fb07-4e2e-9695-0ce167bce8e4" class="numbered-list" start="2"><li>Prevent XSS with Escaping<ol type="a" id="f6be6a94-b6ce-4215-9a59-9ab7930ff216" class="numbered-list" start="1"><li>re-encoding text so that unsafe characters are converted in to a safe &#x27;encoded representation&#x27; ie,.<pre id="c6cc071b-00fd-437c-a9b0-eb366847843a" class="code"><code>&lt;script&gt;

// converts to 

&amp;lt;script&amp;gt;</code></pre><ul id="fc842524-1dc4-4dde-9ff6-cafe3c3de965" class="bulleted-list"><li style="list-style-type:disc">this way the html tag is visible to the user, but not evaluated by the browser</li></ul></li></ol></li></ol><ol type="1" id="006a4959-9ad3-46d7-96c9-084f5475c3ed" class="numbered-list" start="3"><li>test by injection<p id="5f14101e-e113-4251-872f-ca0643a56182" class="">
</p></li></ol><h2 id="d584ae6a-6255-489a-88da-bce94f1dba01" class="">Method 1</h2><hr id="238edcd0-7b4c-43ce-9ac0-60b586e7cc3b"/><p id="8f723792-3f2d-4dde-8cb7-c81637e5ab07" class="">if the tweet element was created with jQuery (not a string literal):<div class="indented"><p id="66603366-57e1-4843-8b17-dae498fa2702" class="">use <code>.text</code> </p></div></p><p id="688c400b-9505-402f-8d4c-269562bf2c39" class="">
</p><p id="42d82e5f-6605-4bb0-8441-34d59f2e3017" class="">jQuery&#x27;s <code>.text()</code> method uses the <code>.createTextNode()</code> DOM method, which escapes unsafe characters, so it is safe to use with untrusted text. For example:</p><pre id="006ef1b9-378f-43cd-8e87-46d82d539a13" class="code"><code>$(&quot;&lt;div&gt;&quot;).text(textFromUser);</code></pre><p id="3596be1b-9a23-4a39-bb38-a84f52a8564d" class="">OR</p><pre id="e03bdc90-ae9a-495b-8de1-f5b8078e81aa" class="code"><code>const $safeText = $(&#x27;&lt;div&gt;&#x27;).text(textFromUser).html()</code></pre><p id="00769b64-e7b9-4762-b2cd-fad5d3ea8110" class="">But then to extract the re encoded text from the JQ object you would need the .html() method with no args.. using .text() again without an arg is like a get. but text seems to get the text before it was encoded.. it almost reverses itself.</p><h2 id="4287c9cd-cca8-4374-875f-2f197570b283" class="">Method 2</h2><hr id="201c8ab0-94fd-41ba-8827-8c50554c8e41"/><p id="5e9b1fb9-bfaa-4d18-ac23-dd984ff86bf7" class="">
</p><p id="f66eddb6-af98-4553-8fca-ebc4f64ffc9d" class="">If the tweet element was created as a string literal (NOT jQuery):<div class="indented"><p id="bd75ac9a-e3e1-46fb-94f2-ae077d31c2e0" class="">Use an escape function using <code>.createTextNode</code></p><figure id="2d6c55c7-6616-4b59-a82f-54515ca03732"><a href="https://developer.mozilla.org/en-US/docs/Web/API/Document/createTextNode" class="bookmark source"><div class="bookmark-info"><div class="bookmark-text"><div class="bookmark-title">Document.createTextNode() - Web APIs | MDN</div><div class="bookmark-description">Creates a new Text node. This method can be used to escape HTML characters.</div></div><div class="bookmark-href"><img src="https://developer.mozilla.org/favicon-48x48.97046865.png" class="icon bookmark-icon"/>https://developer.mozilla.org/en-US/docs/Web/API/Document/createTextNode</div></div><img src="https://developer.mozilla.org/mdn-social-share.0ca9dbda.png" class="bookmark-image"/></a></figure><p id="2344a0f7-b119-468b-a053-648a02964a0f" class="">
</p></div></p><p id="1a2a671f-aa86-4b32-accc-37c660e007c4" class="">EXAMPLE:</p><pre id="e129bd8f-ede9-43cb-868e-ff070c42167e" class="code"><code>const escape = function (str) {
  let div = document.createElement(&quot;div&quot;);
  div.appendChild(document.createTextNode(str));
  return div.innerHTML;
};</code></pre><p id="82356b01-de4f-4d42-bc1f-30f86c12d5ac" class="">Then use the function like this:</p><pre id="ab691870-ecc7-465d-9649-d612b51dc6f2" class="code"><code>const safeHTML = `&lt;p&gt;${escape(textFromUser)}&lt;/p&gt;`;</code></pre><p id="8b5ff416-01dd-4d92-a415-484d8d8b5a16" class="">
</p><p id="c10d9517-5e7d-4ebf-94a1-7ac3f6e25e18" class="">
</p><p id="0c00b52c-fbb3-472c-ab83-848b87203727" class="">
</p></div></article></body></html>